<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>内网渗透体系建设——基础知识 | micgo's blog</title><meta name="keywords" content="内网"><meta name="author" content="micgo"><meta name="copyright" content="micgo"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="内网渗透建设基础知识内网工作环境 工作组 (work group)   组（Group）是用户账号的集合。通过向一组用户分配权限，就可以不必向每个用户分别分配权限了。按照用途分类，域组分为通讯组和安全组 对于通讯组，我们接触的比较多的就是邮件组，将若干个人划分到一个通讯组，给这个通讯组发件，组内用户都能收到 安全组则是用户权限的集合。举个例子，管理员在日常的网络管理中，不必向每个单个用户账号都设置">
<meta property="og:type" content="article">
<meta property="og:title" content="内网渗透体系建设——基础知识">
<meta property="og:url" content="https://micgo.top/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F(2)/index.html">
<meta property="og:site_name" content="micgo&#39;s blog">
<meta property="og:description" content="内网渗透建设基础知识内网工作环境 工作组 (work group)   组（Group）是用户账号的集合。通过向一组用户分配权限，就可以不必向每个用户分别分配权限了。按照用途分类，域组分为通讯组和安全组 对于通讯组，我们接触的比较多的就是邮件组，将若干个人划分到一个通讯组，给这个通讯组发件，组内用户都能收到 安全组则是用户权限的集合。举个例子，管理员在日常的网络管理中，不必向每个单个用户账号都设置">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://my-blog-1309286065.cos.ap-guangzhou.myqcloud.com/img/20201009112151822.jpg">
<meta property="article:published_time" content="2023-03-25T16:00:00.000Z">
<meta property="article:modified_time" content="2023-03-28T13:44:08.846Z">
<meta property="article:author" content="micgo">
<meta property="article:tag" content="内网">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://my-blog-1309286065.cos.ap-guangzhou.myqcloud.com/img/20201009112151822.jpg"><link rel="shortcut icon" href="https://my-blog-1309286065.cos.ap-guangzhou.myqcloud.com/img/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20230225215514.jpg"><link rel="canonical" href="https://micgo.top/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F(2)/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '内网渗透体系建设——基础知识',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-03-28 21:44:08'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="micgo's blog" type="application/atom+xml">
</head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://my-blog-1309286065.cos.ap-guangzhou.myqcloud.com/img/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20230225215514.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">29</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">20</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://my-blog-1309286065.cos.ap-guangzhou.myqcloud.com/img/20201009112151822.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">micgo's blog</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">内网渗透体系建设——基础知识</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-03-25T16:00:00.000Z" title="发表于 2023-03-26 00:00:00">2023-03-26</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-03-28T13:44:08.846Z" title="更新于 2023-03-28 21:44:08">2023-03-28</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/">内网渗透</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="内网渗透体系建设——基础知识"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h4 id="内网渗透建设基础知识"><a href="#内网渗透建设基础知识" class="headerlink" title="内网渗透建设基础知识"></a>内网渗透建设基础知识</h4><h5 id="内网工作环境"><a href="#内网工作环境" class="headerlink" title="内网工作环境"></a>内网工作环境</h5><ul>
<li>工作组 (work group)</li>
</ul>
<blockquote>
<p>组（Group）是用户账号的集合。通过向一组用户分配权限，就可以不必向每个用户分别分配权限了。按照用途分类，域组分为通讯组和安全组</p>
<p>对于通讯组，我们接触的比较多的就是邮件组，将若干个人划分到一个通讯组，给这个通讯组发件，组内用户都能收到</p>
<p>安全组则是用户权限的集合。举个例子，管理员在日常的网络管理中，不必向每个单个用户账号都设置单独的访问权限，只需要创建一个组，对这个组配置访问权限，然后将需要配置该访问权限的用户账号拉进这个组中即可。并且如果管理员在网络运维中需要一些特殊的管理权限时，只需将自己的运维账号拉进该组中就行了</p>
</blockquote>
<p>工作组适用于网络中计算机不多、资产规模较小、对安全管理控制要求不严格的情况。当组织中的网络规模越来越大，需要统一的管理和集中的身份认证，并且能够为用户提供更加方便的网络资源搜索和使用方式是，就要放弃工作组而使用域</p>
<ul>
<li>域</li>
</ul>
<blockquote>
<p>域与工作组概念类似，但是域的计算机集合更大，适用于计算机数量众多的大型网络环境</p>
<p>域用户需要访问域中资源时，必须通过域控制器集中进行身份验证获取相应访问权限</p>
<p>域管理员用户是域中最强大的用户，在域中具有最高访问权限和最高管理权限</p>
<p><strong>单域</strong>： 只有一个域的环境</p>
<p><strong>父域和子域</strong>：把一个域分成若干个域，被划分的叫父域，划分出来的叫子域。从域名上看，各个子域会用点进行分割，如<code>aaa.bbb.ccc</code>是<code>bbb.ccc</code>的子域</p>
<p><strong>域树</strong>：多个域通过建立信任关系组成的域集合，形如子域和父域关系就像子叶和根。域树中域的命名具有连续性</p>
<p>在域树中，域管理员只能管理本域，不能访问或者管理其他域，要访问就要建立信任关系</p>
</blockquote>
<ul>
<li>域控制器(Domain Controller , <strong>DC</strong>)</li>
</ul>
<blockquote>
<p>域控制器又称”域控”，是域环境核心的服务器计算机，用于安全身份认证、存储用户账户信息并执行域的安全策略等</p>
<p>域控制器包含一个活动目录数据库，存储着整个域的账户密码计算机等信息</p>
<p>一个域环境可以拥有多台域控制器</p>
</blockquote>
<h5 id="活动目录"><a href="#活动目录" class="headerlink" title="活动目录"></a>活动目录</h5><p>活动目录(Active Directory , <strong>AD</strong>) 是指安装在域控制器上为整个域环境<strong>提供集中式目录管理服务的组件</strong>。活动目录存储了有关网络对象的信息，例如域、用户、用户组、计算机、组织单位、共享资源、安全策略、打印机和联系人等信息，并使管理员和用户可以方便的查找和使用这些网络信息。 目录数据存储在域控制器的Ntds.dit文件中</p>
<p>主要提供以下功能：计算机集中管理，用户集中管理，资源集中管理，环境集中配置，应用集中管理</p>
<h6 id="Ntds-dit文件"><a href="#Ntds-dit文件" class="headerlink" title="Ntds.dit文件"></a><code>Ntds.dit</code>文件</h6><p>这是域环境的域控制器上保存的<code>%SystemRoot%\ntds\ntds.dtd</code>路径下的二进制文件，是主要的活动目录数据库。这个文件包括但不限于有关域用户，用户密码的哈希值，用户组，组成员身份和组策略的信息。Ntds.dit文件使用存储在SYSTEM文件的密钥对这些哈希值进行加密</p>
<p>在非域环境即工作组环境中，用户的登录凭证存储等信息在本地的SAM文件中</p>
<h6 id="目录服务与LDAP"><a href="#目录服务与LDAP" class="headerlink" title="目录服务与LDAP"></a>目录服务与LDAP</h6><p>活动目录是一个目录服务数据库，里面的数据是树状结构存储</p>
<p>LDAP (全称<code>Lightweight Directory Access Protocol</code>，即轻量级目录访问协议, 和jndi注入用的ldap协议是同一个东西), 可以用于访问目录服务数据库</p>
<p>目录树：整个目录的信息都可以抽象为一个树，每个节点就是条目</p>
<p>条目：每个条目就是一个记录，每个条目哦都有自己唯一的绝对可辨识名称（DN）</p>
<p>DN：就是绝对可辨识名称，它指向一个LDAP对象的完整路径。DN由本体开始，向上延伸到DNS命名空间，CN代表通用名，OU代表组织单位，DC代表域组件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CN=DC1, OU=Domain Controllers, DC=hack-my, DC=com</span><br></pre></td></tr></table></figure>

<p>RDN：相对可辨识名称</p>
<h6 id="活动目录的访问"><a href="#活动目录的访问" class="headerlink" title="活动目录的访问"></a>活动目录的访问</h6><p>这里使用微软提供的<code>AD Exploerer</code>工具，在域中任意一台主机上，以域用户身份进行连接域控制器，链接成功后可以查看域各种信息</p>
<img src="https://my-blog-1309286065.cos.ap-guangzhou.myqcloud.com/img/image-20230326161033965.png" alt="image-20230326161033965" style="zoom:50%;" />

<img src="https://my-blog-1309286065.cos.ap-guangzhou.myqcloud.com/img/image-20230326161024072.png" alt="image-20230326161024072" style="zoom:45%;" />



<h6 id="活动目录分区"><a href="#活动目录分区" class="headerlink" title="活动目录分区"></a>活动目录分区</h6><p>活动目录预定义了域分区、配置分区和架构分区三个分区</p>
<p><strong>域分区</strong> </p>
<p>域分区存储着该域有关的对象信息，比如说域中的计算机、用户、组、组织单位等信息</p>
<p><img src="https://my-blog-1309286065.cos.ap-guangzhou.myqcloud.com/img/image-20230326160542784.png" alt="image-20230326160542784"></p>
<p>可以看到包含了</p>
<img src="https://my-blog-1309286065.cos.ap-guangzhou.myqcloud.com/img/296a1af0f45c395e8035578024ff55258604588f.png" alt="image-20221011165414150" style="zoom:60%;" />

<p><strong>配置分区</strong></p>
<img src="https://my-blog-1309286065.cos.ap-guangzhou.myqcloud.com/img/b4e73cf35b06a1cab93de9f98f4c6fc09f9313ee.png" alt="image-20221011170316953" style="zoom: 80%;" />

<p><strong>架构分区</strong></p>
<img src="https://my-blog-1309286065.cos.ap-guangzhou.myqcloud.com/img/c686df55807aa412c08bc2fde554601e42210126.png" alt="image-20221011171725605" style="zoom:80%;" />

<p>选中一个条目，左边就会有详细信息</p>
<img src="https://my-blog-1309286065.cos.ap-guangzhou.myqcloud.com/img/2ec1803fec9aabf9c151f6fb7bc87be5e93131cc.png" alt="image-20221011171754171" style="zoom:82%;" />

<p>一个条目有哪些属性是由它的所属的类所决定的</p>
<p>ldap中，类有继承关系，子类可以继承父类的所有属性，而top类是所有类的父类</p>
<img src="https://my-blog-1309286065.cos.ap-guangzhou.myqcloud.com/img/b17cc4f3ddc9820a1e9013401053db030aa06a78.png" alt="image-20221011172422886" style="zoom:80%;" />



<h6 id="活动目录的查询"><a href="#活动目录的查询" class="headerlink" title="活动目录的查询"></a>活动目录的查询</h6><p><strong>Active Directory 的查询基础语法</strong></p>
<p><strong><code>BaseDN </code></strong> 即基础可分辨名称，其指定了这棵树的根。比如指定<code>BaseDN</code>为<code>DC=whoamianony,DC=org</code>就是以<code>DC=whoamianony,DC=org</code>为根往下搜索，类似于在文件系统中指定了一个根目录</p>
<img src="https://my-blog-1309286065.cos.ap-guangzhou.myqcloud.com/img/image-20230328144323312.png" alt="image-20230328144323312" style="zoom: 58%;" />

<p>若指定<code>BaseDN</code>为<code>CN=Computers,DC=whoamianony,DC=org</code>就是以<code>CN=Computers,DC=whoamianony,DC=org</code>为根往下搜索</p>
<p><strong>过滤规则</strong></p>
<p>LDAP 搜索过滤器语法有以下逻辑运算符</p>
<table>
<thead>
<tr>
<th align="left">运算符</th>
<th align="left">说明</th>
<th align="left"></th>
</tr>
</thead>
<tbody><tr>
<td align="left">&amp;</td>
<td align="left">AND 运算符</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">\</td>
<td align="left">OR 运算符</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">!</td>
<td align="left">NOT 运算符</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">&#x3D;</td>
<td align="left">用与名称和值做相等比较</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">*</td>
<td align="left">通配符</td>
<td align="left"></td>
</tr>
</tbody></table>
<blockquote>
<p>举几个例子</p>
<p><code>(uid=testuser)</code>：匹配 uid 属性为 testuser 的所有对象 <code>(uid=test*)</code>：匹配 uid 属性以 test 开头的所有对象 <code>(!(uid=test*))</code>：匹配 uid 属性不以 test 开头的所有对象 <code>(&amp;(department=1234)(city=Paris))</code>：匹配 department 属性为1234且city属性为Paris的所有对象 <code>(|(department=1234)(department=56*))</code>：匹配 department 属性的值刚好为1234或者以56开头的所有对象</p>
</blockquote>
<p>需要注意的点就是运算符是放在前面的，跟我们之前常规思维的放在中间不一样</p>
<p><strong>LDAP按位查询</strong></p>
<p>在 LDAP 里面，有些属性字段是位字段，这里以 <code>userAccountControl</code> 举例，其记录了用户的 AD 账号的很多属性信息，该字段就是一个的位字段。之所以说 <code>userAccountControl</code> 是一个位字段，是因为它是由一个个位构成：</p>
<table>
<thead>
<tr>
<th align="left">Property flag</th>
<th align="left">Value in hexadecimal</th>
<th align="left">Value in decimal</th>
</tr>
</thead>
<tbody><tr>
<td align="left">LOCKOUT</td>
<td align="left">0x0010</td>
<td align="left">16</td>
</tr>
<tr>
<td align="left">PASSWD_NOTREQD</td>
<td align="left">0x0020</td>
<td align="left">32</td>
</tr>
<tr>
<td align="left">PASSWD_CANT_CHANGE</td>
<td align="left">0x0040</td>
<td align="left">64</td>
</tr>
<tr>
<td align="left">ENCRYPTED_TEXT_PWD_ALLOWED</td>
<td align="left">0x0080</td>
<td align="left">128</td>
</tr>
<tr>
<td align="left">TEMP_DUPLICATE_ACCOUNT</td>
<td align="left">0x0100</td>
<td align="left">256</td>
</tr>
<tr>
<td align="left">NORMAL_ACCOUNT</td>
<td align="left">0x0200</td>
<td align="left">512</td>
</tr>
<tr>
<td align="left">INTERDOMAIN_TRUST_ACCOUNT</td>
<td align="left">0x0800</td>
<td align="left">2048</td>
</tr>
<tr>
<td align="left">WORKSTATION_TRUST_ACCOUNT</td>
<td align="left">0x1000</td>
<td align="left">4096</td>
</tr>
<tr>
<td align="left">SERVER_TRUST_ACCOUNT</td>
<td align="left">0x2000</td>
<td align="left">8192</td>
</tr>
<tr>
<td align="left">DONT_EXPIRE_PASSWORD</td>
<td align="left">0x10000</td>
<td align="left">65536</td>
</tr>
<tr>
<td align="left">MNS_LOGON_ACCOUNT</td>
<td align="left">0x20000</td>
<td align="left">131072</td>
</tr>
<tr>
<td align="left">SMARTCARD_REQUIRED</td>
<td align="left">0x40000</td>
<td align="left">262144</td>
</tr>
<tr>
<td align="left">TRUSTED_FOR_DELEGATION</td>
<td align="left">0x80000</td>
<td align="left">524288</td>
</tr>
<tr>
<td align="left">NOT_DELEGATED</td>
<td align="left">0x100000</td>
<td align="left">1048576</td>
</tr>
</tbody></table>
<p>比如一个账户，他的 <code>userAccountControl</code> 属性只有 LOCKOUT 和 NOT_DELEGATED 这两个位有值，其他的位都没有，那这个用户的 <code>userAccountControl</code> 属性的值就为 0x100000+0x0010，是个32 位 INT 类型</p>
<p>现在，如果我要搜索域内所有设置了 NOT_DELEGATED 位的所有对象，那么像之前那样简单的 LDAP 搜索语法肯定是不行了。因为简单的 LDAP 搜索语法只能对某个属性进行过滤，还不能对属性里面的某个具体的位进行过滤，这就引出了 LDAP 的按位搜索</p>
<p>LDAP 的按位搜索的语法如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;属性名称&gt;:&lt;BitFilterRule-ID&gt;:= &lt;十进制的位值&gt;</span><br></pre></td></tr></table></figure>

<p>其中的<code>&lt;BitFilterRule-ID&gt;</code>指的是位查询规则所对应的 ID，大致内容如下：</p>
<table>
<thead>
<tr>
<th align="center"><code>位查询规则</code></th>
<th align="center"><code>BitFilterRule-ID</code></th>
</tr>
</thead>
<tbody><tr>
<td align="center">LDAP_MATCHING_RULE_BIT_AND</td>
<td align="center">1.2.840.113556.1.4.803</td>
</tr>
<tr>
<td align="center">LDAP_MATCHING_RULE_OR</td>
<td align="center">1.2.840.113556.1.4.804</td>
</tr>
<tr>
<td align="center">LDAP_MATCHING_RULE_TRANSITIVE_EVAL</td>
<td align="center">1.2.840.113556.1.4.1941</td>
</tr>
<tr>
<td align="center">LDAP_MATCHING_RULE_DN_WITH_DATA</td>
<td align="center">1.2.840.113556.1.4.2253</td>
</tr>
</tbody></table>
<p>最常的用是LDAP_MATCHING_RULE_BIT_AND ，也就是1.2.840.113556.1.4.803</p>
<p>比如我们查询域内所有设置了 NOT_DELEGATED 位的所有对象，NOT_DELEGATED 对应的十进制比较值位 1048576，那么根据语法，我们便可以构造以下过滤语法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="attr">userAccountControl</span>:<span class="number">1.2</span><span class="number">.840</span><span class="number">.113556</span><span class="number">.1</span><span class="number">.4</span><span class="number">.803</span>:=<span class="number">1048576</span>)</span><br></pre></td></tr></table></figure>

<p>想查询哪些对象设置了 TRUSTED_FOR_DELEGATION</p>
<p><img src="https://my-blog-1309286065.cos.ap-guangzhou.myqcloud.com/img/image-20230328151040848.png" alt="image-20230328151040848"></p>
<p>TRUSTED_FOR_DELEGATION对应的十进制比较值为524288，根据语法我们就可以构造以下过滤规则</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(userAccountControl:1.2.840.113556.1.4.803:=524288)</span><br></pre></td></tr></table></figure>



<p><strong>使用<code>AdFind</code>查询活动目录</strong></p>
<p><code>AdFind</code>是一款 C++ 语言编写的域内信息查询的命令行工具，可以再域中任何一台主机上使用，在域渗透里面的出场率极高</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">AdFind.exe [switches]  [-b basedn]  [-f filter]  [attr list]</span><br><span class="line">-b：指定一个BaseDN作为查询的根节点         -f：LDAP过滤条件              attr list：需要显示的属性</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 搜索 whoamianony.org 域下 objectcategory=computer 的所有对象，会显示出所有对象以及对象的所有属性</span><br><span class="line">Adfind.exe -b dc=whoamianony,dc=org -f &quot;objectcategory=computer&quot;</span><br><span class="line"></span><br><span class="line"># 搜索 whoamianony.org 域下 objectcategory=computer 的所有对象，并过滤出对象的name和operatingSystem属性</span><br><span class="line">Adfind.exe -b dc=whoamianony,dc=org -f &quot;objectcategory=computer&quot; name operatingSystem</span><br></pre></td></tr></table></figure>

<p><code>Adfind</code> 还提供了一个快捷的按位查询方式，可以直接用来代替那些复杂的 <code>BitFilterRule-ID</code>：</p>
<table>
<thead>
<tr>
<th align="left">位过滤规则</th>
<th align="left"><code>BitFilterRule-ID</code></th>
<th align="left"><code>Adfind BitFilterRule</code></th>
</tr>
</thead>
<tbody><tr>
<td align="left">LDAP_MATCHING_RULE_BIT_AND</td>
<td align="left">1.2.840.113556.1.4.803</td>
<td align="left">:AND:</td>
</tr>
<tr>
<td align="left">LDAP_MATCHING_RULE_OR</td>
<td align="left">1.2.840.113556.1.4.804</td>
<td align="left">:OR:</td>
</tr>
<tr>
<td align="left">LDAP_MATCHING_RULE_TRANSITIVE_EVAL</td>
<td align="left">1.2.840.113556.1.4.1941</td>
<td align="left">:INCHAIN:</td>
</tr>
<tr>
<td align="left">LDAP_MATCHING_RULE_DN_WITH_DATA</td>
<td align="left">1.2.840.113556.1.4.2253</td>
<td align="left">:DNWDATA:</td>
</tr>
</tbody></table>
<p>上面那个例子可以这样写：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Adfind</span>.<span class="property">exe</span> -b dc=whoamianony,dc=org -f <span class="string">&quot;(userAccountControl:AND:=524288)&quot;</span> -bit -dn</span><br></pre></td></tr></table></figure>



<h5 id="域用户与机器用户"><a href="#域用户与机器用户" class="headerlink" title="域用户与机器用户"></a>域用户与机器用户</h5><p><strong>域用户</strong>，就是域环境中的用户，在域控制器中被创建，并且其所有信息都保存在活动目录中。域用户位于域的全局组Domain Users中，而计算机本地用户账户位于本地User组中。当计算机加入域时，全局组Domain Users会被添加到计算机本地的User组中。因此，域用户可以在域中的任何一台计算机上登录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net user /domain  #查看域中所有的域用户</span><br></pre></td></tr></table></figure>

<p><strong>机器用户</strong>其实是一种特殊的域用户，域用户有的属性机器用户都有</p>
<p>在域环境中，计算机上的本地System用户对应域中的机器用户&#x3D;&#x3D;账户，在域中用户名就是”<strong>机器名+$</strong>“</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net group &quot;Domain Computers&quot; /domain  #查看域中所有的机器用户</span><br></pre></td></tr></table></figure>



<p>当获取一合域中主机的控制权后，发现没有域中用户凭据，此时可以利用一些系统提权方法，将当前用户提升到SYSTEM,以机器账户权限进行域内的操作。如图所示，刚开始以计算机本地用户的权限执行域中命令，由于该用户不是域用户，因<br>此会报错，显示拒绝访问</p>
<img src="https://my-blog-1309286065.cos.ap-guangzhou.myqcloud.com/img/image-20230328154116336.png" alt="image-20230328154116336" style="zoom:80%;" />

<p>这里用<a target="_blank" rel="noopener" href="https://download.sysinternals.com/files/PSTools.zip"><code>psexec</code></a>(<code>pstool</code>)系统内核漏洞提权，将当前用户提升到SYSTEM用户权限，以机器账户权限进行域内的操作</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PsExec -i -s -d cmd</span><br></pre></td></tr></table></figure>

<img src="https://my-blog-1309286065.cos.ap-guangzhou.myqcloud.com/img/c31318f9c4e7a58a0fe3153be4f58e693809e06b.png" alt="image-20221011231241883" style="zoom:120%;" />

<p>之后弹出一个system权限用户的CMD，该用户对应域中的机器账户，具有域用户的属性，所以可以成功执行域中命令</p>
<img src="https://my-blog-1309286065.cos.ap-guangzhou.myqcloud.com/img/image-20230328153932566.png" alt="image-20230328153932566" style="zoom:67%;" />



<h5 id="域用户组的分类和权限"><a href="#域用户组的分类和权限" class="headerlink" title="域用户组的分类和权限"></a>域用户组的分类和权限</h5><p>在域环境中，为了方便对用户权限进行管理，需要将具有相同权限的用户划为一组。只要对这个用户组赋予一定的权限，那么该组内的用户就获得了相同的权限</p>
<p><strong>组的用途</strong></p>
<p>用户账号的集合称为组，按照用途可以分为通讯组和安全组</p>
<blockquote>
<p>通讯组：给通信组发信息时，组内的用户都能收到</p>
<p>安全组：对一个组赋予权限，则组内都是那个权</p>
</blockquote>
<p>根据组的作用范围，安全组可以分为域本地组 通用组和全局组。注意这里的”作用范围”指的是组在域树或域林中应用的范围</p>
<ul>
<li>域本地组</li>
</ul>
<p>查询域内的所有域本地组：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Adfind.exe -b dc=hack-my,dc=com -bit -f &quot;(&amp;(objectClass=group)(grouptype:AND:=4))&quot; cn -dn</span><br></pre></td></tr></table></figure>

<p>几个的常见的系统内置的域本地组及其组权限：</p>
<blockquote>
<p>Administrators：管理员组，该组的成员可以不受限制地存取计算机&#x2F;域的资源。不仅是最具有权限的一个组，也是在活动目录和域控制器中默认具有管理员权限的组，是域森林中强大的服务管理组</p>
<p>Remote Desktop Users：远程登录组，处于远程登录组中的用户才有权限使用远程登录服务</p>
<p>Print Operators：打印机操作员组，位于该组内的成员可以管理网络中的打印机，还可以在本地登录和关闭域控制器</p>
<p>Account Operators：账号操作员组，该组的成员可以创建和管理该域中的用户和组并为其设置权限，也可以在本地登录域控制器，但不能更改属于Administrators或Domain Admins组的账户，也不能修改这些组。默认情况下该组中没有成员</p>
<p>Server Operators：服务器操作员组，该组的成员可以管理域服务器，其权限包括建立&#x2F;管理&#x2F;删除任意服务器的共享目录、管理网络打印机、备份任何服务器的文件、格式化服务器硬盘、锁定服务器、变更服务器的系统时间、关闭域控制器等。默认情况下该组中没有成员</p>
<p>Backup Operators：备份操作员组，该组的成员可以在域控制器中执行备份和还原操作，还可以在本地登录和关闭域控制器。默认情况下该组中没有成员</p>
</blockquote>
<ul>
<li><p>通用组</p>
<p>查询域内的所有通用组：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Adfind.exe -b dc=hack-my,dc=com -bit -f &quot;(&amp;(objectClass=group)(grouptype:AND:=8))&quot; cn -dn</span><br></pre></td></tr></table></figure>

<p>两个的常见的系统内置的通用组及其组权限：</p>
<blockquote>
<p>Enterprise Admins：组织系统管理员组，该组是域林的根域中的一个组。Enterprise Admins 组中的成员在域林中的每个域内都是 Administrators 组的成员，因此对所有域控制器都有完全访问控制权</p>
<p>Schema Admins：架构管理员组，该组是域森林的根域中的一个组，该组成员可以修改活动目录和域森林的模式。Schema Admins 组是为活动目录和域控制器提供完整权限的域用户组，因此，该组成员的资格是非常重要的</p>
</blockquote>
</li>
<li><p>全局组</p>
<p>以下命令可以查询域内的所有全局组：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Adfind.exe -b dc=hack-my,dc=com -bit -f &quot;(&amp;(objectClass=group)(grouptype:AND:=2))&quot; cn -dn</span><br></pre></td></tr></table></figure>

<p>几个的常见的系统内置的全局组及其组权限：</p>
<blockquote>
<p>Domain Admins：域管理员组，该组的成员在所有加入域的服务器、域控制器和活动目录中均默认拥有完整的管理员权限。因为该组会被添加到自己所在域的 Administrators 组中，因此可以继承 Administrators 组的所有权限。同时，该组默认会被添加到每台域成员计算机的本地 Administrators 组中，这样Domain Admins 组就获得了域中所有计算机的所有权。如果希望某用户成为域系统管理员，建议将该用户添加到 Domain Admins 组中，而不要直接将该用户添加到 Administrators 组中</p>
<p>Domain Users：域用户组，该组的成员中是所有的域用户。默认情况下任何由我们新建立的计算机账号都是该组成员</p>
<p>Domain Computers：域成员主机组，该组的成员是域内所有的域成员主机，任何由我们建立的计算机账号都属于 Domain Computers 组</p>
<p>Domain Controllers：域控制器组，该组成员包含了域内所有的域控制器</p>
<p>Domain Guests：域访客用户组，该组内的成员默认为域访客用户，域成员计算机会自动将此组加到本地的 Guests 组中</p>
<p>Group Policy Creator Owners：新建组策略对象组，此组成员可以修改域的组策略</p>
</blockquote>
</li>
</ul>
<h5 id="组织单位"><a href="#组织单位" class="headerlink" title="组织单位"></a>组织单位</h5><p>当需要对用户赋予某特殊权限时，可以设置一个域用户组，对这个组配置资源访问权限，再将该用户拉进这个组，这样用户就拥有了这个组的权限。同样，如果需要对指定部门的用户进行统一管理，便可以设置类似集合的概念，然后把该部门的用户拉入，这样就可以对该部门的用户进行集中管理了，如下发组策略等。这个集合就是组织单位。<br>组织单位(Organization Unit, <strong>OU</strong>)是一个可以将域中的用户、组和计算机等对象放入其中的容器对象，是可以指派组策略或委派管理权限的最小作用域或单元</p>
<img src="https://my-blog-1309286065.cos.ap-guangzhou.myqcloud.com/img/image-20230328211112366.png" alt="image-20230328211112366" style="zoom:70%;" />

<p>所有组织单位在活动目录中都是<code>organizationalUnit</code>类的示例，所以可以通过 <code>(objectclass=organizationalUnit)</code><br>或  <code> (objectCategory=organizationalUnit)</code>  来查询所有的OU:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Adfind.exe -b &quot;dc=hack-my, dc=com&quot; -f  &quot;(objectclass=organizationalUnit)&quot; -dn</span><br></pre></td></tr></table></figure>

<img src="https://my-blog-1309286065.cos.ap-guangzhou.myqcloud.com/img/image-20230328211416152.png" alt="image-20230328211416152" style="zoom:60%;" />

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Adfind.exe -b &quot;OU=科研中心,DC=hack-my,DC=com&quot; -dn  #查询&quot;科研中心&quot;的对象</span><br></pre></td></tr></table></figure>

<img src="https://my-blog-1309286065.cos.ap-guangzhou.myqcloud.com/img/image-20230328211527441.png" alt="image-20230328211527441" style="zoom:67%;" />



<h5 id="访问控制"><a href="#访问控制" class="headerlink" title="访问控制"></a>访问控制</h5><h6 id="Windows访问控制模型"><a href="#Windows访问控制模型" class="headerlink" title="Windows访问控制模型"></a>Windows访问控制模型</h6><p>Windows访问控制模型主要由访问令牌（Access Token）和安全描述符（Security Descriptor）两部分组成，分别由访问者和被访问者持有。通过比较两者，可以知道访问者有无访问资源对象</p>
<p>访问令牌</p>
<p>当用户登录时，Windows将对用户进行身份验证，如果验证通过，就会为用户创建一个访问令牌，包括登录过程返回的SID、由本地安全策略分配给用户和用户所属安全组的特权列表。此后，代表该用户执行的每个进程都有此访问令牌的副本，每当线程或进程与安全对象交互或尝试执行需要特权的系统任务，Windows都会使用此访问令牌标识并确定关联的用户</p>
<p>安全描述符</p>
<p>当安全对象被创建时，操作系统会为其创建一个安全描述符。安全描述符主要由SID和ACL（Access Control List,访问控制列表)组成。SID用来标识用户账户和该用户所属的组。ACL分为DACL和SACL两种</p>
<h6 id="访问控制列表"><a href="#访问控制列表" class="headerlink" title="访问控制列表"></a>访问控制列表</h6><p>访问控制列表(ACL)是访问控制项(Access Control Entry, ACE)的列表 访问控制列表中的每个访问控制项指定了一系列访问权限</p>
<p>DACL自主访问控制列表  SACL系统访问控制列表</p>
<p><code>Icacls</code>是一种命令行工具，可以查看和修改指定文件上的访问控制列表（ACL），并将存储的DACL应用于指定目录的文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">简单权限序列 (基本权限):</span><br><span class="line">F - 完全访问权限</span><br><span class="line">M- 修改访问权限</span><br><span class="line">RX - 读取和执行访问权限</span><br><span class="line">R - 只读访问权限</span><br><span class="line">W - 仅写访问权限</span><br><span class="line">特定权限的括号中的逗号分隔列表 (高级权限):</span><br><span class="line">D - 删除</span><br><span class="line">RC - 读取控制 (读取权限)</span><br><span class="line">WDAC - 写入 DAC (更改权限)</span><br><span class="line">WO - 写入所有者 (获取所有权)</span><br><span class="line">S - 同步</span><br><span class="line">AS - 访问系统安全性</span><br><span class="line">MA - 允许的最大数量</span><br><span class="line">GR - 泛型读取</span><br><span class="line">GW - 泛型写入</span><br><span class="line">GE - 泛型执行</span><br><span class="line">GA - 全部通用</span><br><span class="line">RD - 读取数据/列表目录</span><br><span class="line">WD - 写入数据/添加文件</span><br><span class="line">AD - 追加数据/添加子目录</span><br><span class="line">REA - 读取扩展属性</span><br><span class="line">WEA - 编写扩展属性</span><br><span class="line">X - 执行/遍历</span><br><span class="line">DC - 删除子级</span><br><span class="line">RA - 读取属性</span><br><span class="line">WA - 写入属性</span><br><span class="line">继承权可能位于任一 &lt;perm&gt; 形式之前：</span><br><span class="line">(我) - 继承。 ACE 继承自父容器</span><br><span class="line">(OI) - 对象继承。 此容器中的对象将继承此 ACE。 仅适用于目录</span><br><span class="line">(CI) - 容器继承。 此父容器中的容器将继承此 ACE。 仅适用于目录</span><br><span class="line">(IO) - 仅继承。 ACE 继承自父容器，但不适用于对象本身。 仅适用于目录</span><br><span class="line">(NP) - 不传播继承。 ACE 由容器和对象从父容器继承，但不传播到嵌套容器。 仅适用于目录</span><br></pre></td></tr></table></figure>



<h5 id="组策略"><a href="#组策略" class="headerlink" title="组策略"></a>组策略</h5><p>组策略是Windows环境下管理账户的一种手段，可以控制用户账户和计算机账户的工作环境</p>
<p>包括但不限于以下功能：</p>
<ul>
<li>账户策略的配置：如密码长度，复杂程度</li>
<li>脚本的配置：如登录与注销、启动和关机脚本的设置</li>
<li>应用程序的安装与删除：用户登录或计算机启动时，自动为用户安装应用，自动修复应用的错误</li>
<li>文件夹重定向</li>
<li>限制访问可移动存储设备</li>
<li>用户工作环境的配置</li>
<li>其他系统设置等</li>
</ul>
<h6 id="组策略对象"><a href="#组策略对象" class="headerlink" title="组策略对象"></a>组策略对象</h6><p>组策略对象(Group Policy Object,GPO)即组策略设置的集合，其中包含应用于特定用户或计算机的策略信息和具体配置。在设置组策略时，只需将组策略对象链接到指定的站点、域和组织单位，其中的策略值便会应用到该站点、域和组织单位的所有用户和计算机</p>
<p>组策略对象由组策略容器(Group Policy Container, GPC)和组策略模板(Group Policy Container, GPT)构成，其中组策略容器存储在活动目录的域分区，组策略模板放在域控制器的如下文件夹中: <code>%SYSTEMROOT%\SYSVOL\sysvol\域名\Polices</code></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://micgo.top">micgo</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://micgo.top/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F(2)/">https://micgo.top/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F(2)/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用<meta name="referrer" content="no-referrer"> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://micgo.top" target="_blank">micgo's blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%86%85%E7%BD%91/">内网</a></div><div class="post_share"><div class="social-share" data-image="https://my-blog-1309286065.cos.ap-guangzhou.myqcloud.com/img/20201009112151822.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/"><img class="prev-cover" src="https://my-blog-1309286065.cos.ap-guangzhou.myqcloud.com/img/20201009112151822.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">内网渗透体系建设——内网信息收集</div></div></a></div><div class="next-post pull-right"><a href="/%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/XXE%E5%A4%96%E9%83%A8%E5%AE%9E%E4%BD%93%E6%B3%A8%E5%85%A5/"><img class="next-cover" src="https://my-blog-1309286065.cos.ap-guangzhou.myqcloud.com/img/20201009112151822.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">XXE外部实体注入</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://my-blog-1309286065.cos.ap-guangzhou.myqcloud.com/img/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20230225215514.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">micgo</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">29</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">20</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/micgo520"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E5%BB%BA%E8%AE%BE%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="toc-number">1.</span> <span class="toc-text">内网渗透建设基础知识</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%86%85%E7%BD%91%E5%B7%A5%E4%BD%9C%E7%8E%AF%E5%A2%83"><span class="toc-number">1.1.</span> <span class="toc-text">内网工作环境</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95"><span class="toc-number">1.2.</span> <span class="toc-text">活动目录</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Ntds-dit%E6%96%87%E4%BB%B6"><span class="toc-number">1.2.1.</span> <span class="toc-text">Ntds.dit文件</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95%E6%9C%8D%E5%8A%A1%E4%B8%8ELDAP"><span class="toc-number">1.2.2.</span> <span class="toc-text">目录服务与LDAP</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%9A%84%E8%AE%BF%E9%97%AE"><span class="toc-number">1.2.3.</span> <span class="toc-text">活动目录的访问</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E5%88%86%E5%8C%BA"><span class="toc-number">1.2.4.</span> <span class="toc-text">活动目录分区</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95%E7%9A%84%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.2.5.</span> <span class="toc-text">活动目录的查询</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9F%9F%E7%94%A8%E6%88%B7%E4%B8%8E%E6%9C%BA%E5%99%A8%E7%94%A8%E6%88%B7"><span class="toc-number">1.3.</span> <span class="toc-text">域用户与机器用户</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9F%9F%E7%94%A8%E6%88%B7%E7%BB%84%E7%9A%84%E5%88%86%E7%B1%BB%E5%92%8C%E6%9D%83%E9%99%90"><span class="toc-number">1.4.</span> <span class="toc-text">域用户组的分类和权限</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BB%84%E7%BB%87%E5%8D%95%E4%BD%8D"><span class="toc-number">1.5.</span> <span class="toc-text">组织单位</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6"><span class="toc-number">1.6.</span> <span class="toc-text">访问控制</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Windows%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.6.1.</span> <span class="toc-text">Windows访问控制模型</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6%E5%88%97%E8%A1%A8"><span class="toc-number">1.6.2.</span> <span class="toc-text">访问控制列表</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BB%84%E7%AD%96%E7%95%A5"><span class="toc-number">1.7.</span> <span class="toc-text">组策略</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%BB%84%E7%AD%96%E7%95%A5%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.7.1.</span> <span class="toc-text">组策略对象</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/%E6%B8%97%E9%80%8F/ctfshow%E7%BB%88%E6%9E%81%E8%80%83%E6%A0%B8/" title="ctfshow终极考核">ctfshow终极考核</a><time datetime="2023-04-12T16:00:00.000Z" title="发表于 2023-04-13 00:00:00">2023-04-13</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F(7)/" title="内网渗透体系建设——Kerberos攻击专题">内网渗透体系建设——Kerberos攻击专题</a><time datetime="2023-04-06T16:00:00.000Z" title="发表于 2023-04-07 00:00:00">2023-04-07</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F(6)/" title="内网渗透体系建设——权限维持">内网渗透体系建设——权限维持</a><time datetime="2023-04-04T16:00:00.000Z" title="发表于 2023-04-05 00:00:00">2023-04-05</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F(5)/" title="内网渗透体系建设——横向移动">内网渗透体系建设——横向移动</a><time datetime="2023-04-03T16:00:00.000Z" title="发表于 2023-04-04 00:00:00">2023-04-04</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F(4)/" title="内网渗透体系建设——权限提升">内网渗透体系建设——权限提升</a><time datetime="2023-04-01T16:00:00.000Z" title="发表于 2023-04-02 00:00:00">2023-04-02</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://my-blog-1309286065.cos.ap-guangzhou.myqcloud.com/img/20201009112151822.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By micgo</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '2t5fYJ95Y61Dyi4xHc3dWgxl-gzGzoHsz',
      appKey: 'UNfGz5zfJGeNX6LS5OyiymLm',
      avatar: 'monsterid',
      serverURLs: 'https://2t5fyj95.lc-cn-n1-shared.com',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>